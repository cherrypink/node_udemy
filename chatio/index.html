<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <!--[if IE]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <![endif]-->
    <title>CHATIo</title>
    <!-- BOOTSTRAP CORE STYLE CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
  integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<style>
	
		#container{
/* 			border: 2px solid #ffffff;
    background-color: #ffffff;
    border-radius: 5px;
    padding: 6px; */
		}
		#mainWrapper{
			display:none;
		}

		#chatWrapper{
			/* border: 1px #ccc solid;
    border-radius: 10px;
    background: rgba(233, 255, 175, 0.46);
    padding: 10px;
    overflow-y:auto;
    overflow-x:hidden;
    border-right:solid #ff920a 2px;
    min-height:200px; */
		}

		#userWrapper{


		}

		#namesWrapper{
	
					}

	/* 	#input{
			height:30px;
			border : solid 1px #ccc;
		}
		 */
	</style>
</head>
<body style="font-family:Verdana">
	<div class="container" id = "container" >
		<div id ="namesWrapper">
			<h2>ChatIO</h2>
			<p>Create UserName : </p>
			<div id="error">
			</div>
			<form id="usernameForm">
				<input type="text"id="username"/>
				<select name="room" id="room">
					<option value="room1">room1</option>
					<option value="room2">room2</option>
					<option value="room3">room3</option>
				</select>
				<input class="btn btn-success" type="submit" value="submit" />
			</form>
		</div>
<div class="row " style="padding-top:40px;">
<br />
    <div class="col-md-8">
        <div class="panel panel-info" id="mainWrapper" >
            <div class="panel-heading">
                RECENT CHAT HISTORY
            </div>
            <div class="panel-body" id="chatWrapper">					
<!-- 			<div id="chatWrapper"> -->
<ul class="media-list">

                                    <li class="media">
                                        <div class="media-body" id="chatWindow"></div>
                                        </li>
                                        </ul>
                                        <div class="panel-footer">
                <div class="input-group">
				<form id="messageForm">
					<input type="text" id="message" placeholer="Say Something..."/>
					<input type="submit" value="submit" />

				</form>
				</div>
				</div>
			</div>
			
		</div>
		 <div class="col-md-4">
          <div class="panel panel-primary">
          <div class="panel-heading">
               CURRENT USERS
            </div>
		<div id="users"></div>
		</div>
		</div>
</div>
	</div>
</div>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		$(function(){
			var currentStart = 0;
			var limit = 10;
			var socket = io.connect();
			var $messageForm = $('#messageForm');
			var $message = $('#message');
			var $chat = $('#chatWindow');
			var $usernameForm = $('#usernameForm');
			var $users = $('#users');
			var $username = $('#username');
			var $error = $('#error');
			var $room  = $('#room');

			$usernameForm.submit(function(e){
				e.preventDefault();
				var enterInfo = { 'username' : $username.val() ,
												  'room'     : $room.val(),
													'currentStart' : currentStart,
													'limit' : limit
												};
				socket.emit('new user', enterInfo, function(data){
					if(data !=null){
						$('#namesWrapper').hide();
						$('#mainWrapper').show();
						data.forEach(function(msg){
							$chat.append('<strong>'+msg.username +'</strong>'+ ' : ' +msg.message+'<br>');
						});
					}else{
						$error.html('Username is taken');
					}
				});

			});

			socket.on('usernames',function(data){
				var html = '';
				for(i = 0; i< data.length; i++){
					html += data[i].username + '<br>';
				}

				$users.html(html);
			});

			$messageForm.submit(function(e){
				e.preventDefault();
				var info = { 'msg' : $message.val(),
			 							 'room': $room.val()};
				socket.emit('send message', info);// $message.val());
				$message.val('');
			});

			socket.on('new message', function(data){
				$chat.append('<strong>'+data.user +'</strong>'+ ' : ' +data.msg+'<br>');
			});
		});
	</script>

</body>
</html>
